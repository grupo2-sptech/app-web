<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./assets/icons/style.css" />
  <link rel="stylesheet" href="./css/style-login.css">
  <title>Hardware Security</title>
</head>

<body>
  <div class="container" id="container">
    <div class="form-container sign-in">
      <form>
        <h1>Entrar</h1>
        <div class="social"></div>
        <span>Entre com email e senha</span>
        <div>
          <input id="input_email" type="email" placeholder="Email" />
          <input id="input_senha" type="password" placeholder="senha" />
        </div>
        <div class="div_button">
          <button onclick="entrar()">Entrar</button>
          <button onclick="voltar()">Voltar</button>
        </div>
        <a style="color: black; cursor: pointer; margin-top: 2rem;" onclick="forgotPassword()">Esqueci a senha</a>
        <strong id="mensagem_senha_incorreta"></strong>
        <div id="carregar" class="gif_carregar">
          <img src="https://c.tenor.com/I6kN-6X7nhAAAAAj/loading-buffering.gif" alt="">
        </div>
      </form>
    </div>
    <div class="painel-container">
      <div class="painel">
        <div class="toggle-panel painel-direita">
          <h1>Seja bem vindo!</h1>
          <p>
            Entre com seus dados pessoais para usar todos os recursos do site
          </p>
        </div>
      </div>
    </div>
  </div>
</body>

</html>

<script>
  function entrar() {
    event.preventDefault();
    mensagem_senha_incorreta.innerHTML = ""
    var senha = input_senha.value;
    var email = input_email.value;
    var strong_senha_incorreta = document.getElementById('mensagem_senha_incorreta');
    var div_carregar = document.getElementById('carregar');

    if (senha == "" || email == "") {
      mensagem_senha_incorreta.innerHTML = `Preencha todos os campos!`;
      return false;
      div_carregar.style.display = "block";
    } else {
      fetch("/usuarios/autenticar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          emailServer: email,
          senhaServer: senha
        })
      }).then(function (resposta) {
        console.log("ESTOU NO THEN DO entrar()!")
        debugger
        if (resposta.ok) {
          div_carregar.style.display = "block";
          console.log(resposta);
          resposta.json().then(json => {
            console.log(json);
            console.log(JSON.stringify(json));
            sessionStorage.EMAIL_USUARIO = json.email;
            sessionStorage.NOME_USUARIO = json.nome;
            sessionStorage.ID_USUARIO = json.id;
            sessionStorage.AQUARIOS = JSON.stringify(json.hardware)
            setTimeout(() => {
              window.location.href = "dashboard.html";
            }, 2000);
          });

        } else {

          resposta.text().then(texto => {
            div_carregar.style.display = "block";
            setTimeout(() => {
              mensagem_senha_incorreta.innerHTML = texto;
              div_carregar.style.display = "none";
            }, 2000);
            console.error(texto);
          });
        }

      }).catch(function (erro) {
        console.log(erro);
      })
      return false;
    }
  }


  function voltar() {
    mensagem_senha_incorreta.innerHTML = ""
    event.preventDefault();
    carregar.style.display = "block"
    setInterval(() => {
      window.location.href = "index.html";
    }, 1000);
  }


</script>