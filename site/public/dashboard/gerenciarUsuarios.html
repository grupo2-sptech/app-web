<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hardware Security</title>
  <link rel="stylesheet" href="../css/dashboards.css" />
  <link rel="stylesheet" href="../css/gerenciarUsuario.css">
  <link rel="stylesheet" href="../assets/icons/style.css" />
  <script src="../js/dashboard.js"></script>
  <script src="../js/sessao.js"></script>
  <script src="../js/gerenciarUsuario.js"></script>
</head>

<body onload="validarSessao(), listarUsuarios(sessionStorage.SETOR, sessionStorage.ID_EMPRESA)">
  <!-- menuLateral -->
  <div id="menu" class="menuLateral">
    <a>
      <div class="logo">
        <img id="logotipo" src="../assets/icon/seguranca.png" alt="" />
      </div>
    </a>
    <div id="itens_menu" class="itens_menu">
      <div style="color: white; font-size: 11px; margin-top: -130%; text-align: center;">
        <strong style="font-size: 12px;">Olá,</strong><br>
        <strong style="font-size: 12px;" id="nome_usuario"></strong>
      </div>
      <div style="height: 60%; justify-content: space-around; display: flex; flex-direction: column;">
        <a class="itensDaNav" href="dashboard.html">
          <div class="icon-stats-dots ico"></div>
          <span class="nome-acao">Dashboard</span>
        </a>
        <a  class="itensDaNav" href="gerenciarProcessos.html">
          <div style="font-weight: bold;" class="icon-document-forbidden1 ico"></div>
          <samp style="text-align: center;" class="nome-acao">Lista de Bloqueios</samp>
        </a>
        <a class="itensDaNav" href="#">
          <div class="ico">
            <img src="../assets/imgs/gerenciar_user.svg" alt="">
          </div>
          <samp style="text-align: center;" class="nome-acao">Adicionar<br>Usuário</samp>
        </a>
        <!-- <a id="gerenciamento_user" class="itensDaNav" href="#">
          <div>
            <img src="../assets/imgs/gerenciar_setor.png" alt="">
          </div>
          <samp style="text-align: center;" class="nome-acao">Adicionar<br>Usuário</samp>
        </a> -->
        <a class="itensDaNav" href="suporte.html">
          <div class="icon-support_agent ico"></div>
          <samp class="nome-acao">Suporte</samp>
        </a>
      </div>
      <a onclick="limparSessao()" class="itensDaNav">
        <div class="icon-log-in ico"></div>
        <samp class="nome-acao">Sair</samp>
      </a>
    </div>
  </div>

  <main class="mainGerenciarUsuario">
    <div class="tituloGerenciar" id="tituloGerenciar">
      <h1 class="titulo">Gerenciar Usuários</h1>
      <div class="icon-user-plus" id="botaoAdicionar"></div>
    </div>

    <div class="menuGerenciar" id="menuGerenciar">

      <table>
        <thead>
          <tr>
            <th></th>
            <th><span>Nome</span></th>
            <th><span>E-mail</span></th>
            <th><span>Setor</span></th>
            <th><span>Cargo</span></th>
            <th><span>Acesso</span></th>
            <th></th>
            <th></th>
          </tr>
        </thead>
      </table>



    </div>

    <div class="adicionarUsuario" id="adicionarUsuario">
      <h1>Adicionar Usuário</h1>

      <div class="rotulosUsuario">

        <div class="rotulos">
          <label for="nome">Nome:</label>
          <input class="inputRotulos" id="input_rotuloNome" type="text" placeholder="Digite o nome" required>
        </div>

        <!--    <div class="rotulos">
          <label for="nome">Sobrenome:</label>
          <input class="inputRotulos" type="text" placeholder="Digite o nome" required>
        </div> -->

        <div class="rotulos">
          <label for="email">E-mail:</label>
          <input class="inputRotulos" id="input_rotuloEmail" type="text" placeholder="Digite o E-mail">
        </div>

        <div class="rotulos">
          <label for="setor">Setor:</label>
          <select class="selectRotulos" name="" id="selectSector">
            <option class="" value="" disabled selected>Selecione o Setor</option>
            <option value="1">Financeiro</option>
          </select>
        </div>

        <div class="rotulos">
          <label for="Cargo">Cargo:</label>
          <input class="inputRotulos" id="input_rotuloCargo" type="text" placeholder="Informe o Cargo">
        </div>

        <div class="rotulos">
          <label for="Cargo">Senha:</label>
          <input class="inputRotulos" id="input_rotuloSenha" type="text" placeholder="Defina a senha de acesso">
        </div>
      </div>

      <div class="rotulos">
        <label for="setor">Permissão:</label>
        <select class="selectRotulos" name="" id="selectPermission">
          <option class="" value="" disabled selected>Selecione</option>
          <option value="false">Usuário</option>
          <option value="true">Administrador</option>
        </select>
      </div>

      <div style="display: flex; gap: 2rem;">
        <button class="botaoCancelar" id="botaoCancelar">Cancelar</button>
        <button class="botaoConfirmar" onclick="criarUsuario()">Confirmar</button>
      </div>

    </div>



  </main>

</body>
</html>

<script>

  let nome = sessionStorage.NOME_USUARIO
  let setor = sessionStorage.SETOR
  let empresa = sessionStorage.ID_EMPRESA

  function criarUsuario() {
      var novoNome = input_rotuloNome.value;
      var novoEmail = input_rotuloEmail.value;
      var novoCargo = input_rotuloCargo.value;
      var novaSenha = input_rotuloSenha.value;
      var permissão = selectPermission.value;
      var setor = 200;
      var empresa = 100;
      var permissaoTotal = true;

      fetch("/gerenciarUsuario/cadastrarUsuario", {
        method: 'POST',
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nome: novoNome,
          email: novoEmail,
          cargo: novoCargo,
          senha: novaSenha,
          permissao: permissão,
          setor: setor,
          empresa: empresa,
          permissaoTotal: permissaoTotal,
        }),
      })
      .then(response => response.json())
      .catch(error => console.error('Error:', error));

  }

  function listarUsuarios(setor, empresa) {
    fetch("/gerenciarUsuario/listarUsuarios", {
      method: 'GET',
      headers: {
        "Content-Type": "application/json"
      },
    })
    .then(response => response.json())
    .then(data => {
      
      data.forEach(usuario => {
        
        const tr = document.createElement("tr");

tr.innerHTML = `
    <td><div class="icon-user"></div></td>
    <td>${usuario.nome}</td>
    <td>${usuario.email}</td>
    <td>${usuario.setor}</td>
    <td>${usuario.cargo}</td>
    <td>${usuario.permissao}</td>
    <td><div class="icon-pencil"></div></td>
    <td><div class="icon-trash"></div></td>
    `;

// Adiciona a linha criada ao tbody
tbody.appendChild(tr);

        
      });
    })
    .catch(error => console.error('Error:', error));
  }

  nome_usuario.innerHTML = nome;

</script>